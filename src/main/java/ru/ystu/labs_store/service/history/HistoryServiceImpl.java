package ru.ystu.labs_store.service.history;import org.springframework.stereotype.Service;import ru.ystu.labs_store.model.Cart;import ru.ystu.labs_store.model.History;import ru.ystu.labs_store.model.User;import ru.ystu.labs_store.repository.CartRepository;import ru.ystu.labs_store.repository.HistoryRepository;import ru.ystu.labs_store.repository.UserRepository;import java.text.SimpleDateFormat;import java.util.Date;import java.util.List;import java.util.stream.Collectors;@Servicepublic class HistoryServiceImpl implements HistoryService {	private final HistoryRepository historyRepository;	private final CartRepository cartRepository;	private final UserRepository userRepository;	public HistoryServiceImpl(HistoryRepository historyRepository, CartRepository cartRepository, UserRepository userRepository) {		this.historyRepository = historyRepository;		this.cartRepository = cartRepository;		this.userRepository = userRepository;	}	@Override	public List<History> addProductListToArchive(List<Cart> productList, String login) {		if (!productList.isEmpty()) {			double price = 0d;			for (Cart product : productList) {				double priceProduct = product.getProduct().getPrice() * product.getCount();				price += priceProduct;			}			SimpleDateFormat sdf = new SimpleDateFormat("dd MMM");			String dateTimeOrder = sdf.format(new Date());			User user = userRepository.findUserByLogin(login);			History history = historyRepository.save(new History(price, dateTimeOrder, user));			productList.forEach(it -> it.setIdArchive(history));			cartRepository.saveAll(productList);		}		return getHistoryList(login);	}	@Override	public List<History> getHistoryList(String login) {		User user = userRepository.findUserByLogin(login);		if (user != null) {			return historyRepository.findAll().stream().filter(it ->					it.getUser().getId() == user.getId())					.collect(Collectors.toList());		} else {			return historyRepository.findAll();		}	}}
package ru.ystu.labs_store.controller;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.PathVariable;import ru.ystu.labs_store.model.Cart;import ru.ystu.labs_store.model.History;import ru.ystu.labs_store.service.cart.CartService;import ru.ystu.labs_store.service.history.HistoryService;import javax.servlet.http.HttpServletRequest;import java.util.List;@Controllerpublic class CartController {	private final CartService cartService;	private final HistoryService historyService;	public CartController(CartService service, HistoryService historyService) {		this.cartService = service;		this.historyService = historyService;	}	@GetMapping("/cart")	public String showCart(Model model, HttpServletRequest request) {		String login = request.getUserPrincipal().getName();		List<Cart> productList = cartService.getProductList(login, null);		String totalPrice = cartService.getTotalPrice(login, null);		model.addAttribute("products", productList);		model.addAttribute("total_price", totalPrice);		model.addAttribute("is_cart", true);		return "cartPage";	}	@GetMapping("/cart/increase/{id}")	public String increaseProductCart(HttpServletRequest request, @PathVariable("id") int id) {		cartService.increaseCountProduct(id);		return "redirect:/cart";	}	@GetMapping("/cart/decrease/{id}")	public String decreaseProductCart(HttpServletRequest request, @PathVariable("id") int id) {		cartService.decreaseCountProduct(id);		return "redirect:/cart";	}	@GetMapping("/cart/remove/{id}")	public String removeProductFromCart(HttpServletRequest request, @PathVariable("id") int id) {		cartService.removeProductById(id);		return "redirect:/cart";	}	@GetMapping("/cart/add/{id}")	public String addProductToCart(HttpServletRequest request, @PathVariable("id") int id) {		String login = request.getUserPrincipal().getName();		cartService.addProductToCartById(id, login);		return "redirect:/cart";	}	@GetMapping("/cart/buy")	public String buyProducts(Model model, HttpServletRequest request) {		String login = request.getUserPrincipal().getName();		List<Cart> productList = cartService.getProductList(login, null);		List<History> historyList = historyService.addProductListToArchive(productList, login);		model.addAttribute("archives", historyList);		return "historyPage";	}	@GetMapping("/cart/history")	public String historyOrders(Model model, HttpServletRequest request) {		String login = request.getUserPrincipal().getName();		List<History> archiveList = historyService.getHistoryList(login);		model.addAttribute("archives", archiveList);		return "historyPage";	}	@GetMapping("/cart/history/{id}")	public String archiveProducts(@PathVariable("id") int id, Model model, HttpServletRequest request) {		String login = request.getUserPrincipal().getName();		List<Cart> productList = cartService.getProductListByIdHistory(login, id);		String totalPrice = cartService.getTotalPrice(login, id);		model.addAttribute("total_price", totalPrice);		model.addAttribute("products", productList);		model.addAttribute("is_cart", false);		return "cartPage";	}}